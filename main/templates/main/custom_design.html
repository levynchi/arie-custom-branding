{% extends 'main/base.html' %}
{% load static %}

{% block title %}עיצוב אישי - אריה קאסטום מיתוגים{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'main/css/custom_design.css' %}">
{% endblock %}

{% block content %}
<!-- SUPER SIMPLE AI SECTION AT THE TOP -->
<div class="ai-design-generator">
    <h1 class="text-center mb-4">
        <i class="fas fa-magic me-2"></i>🤖 AI DESIGN GENERATOR
    </h1>
    <textarea id="aiDesignPromptSimple" class="form-control mb-3" rows="4" placeholder="כתוב כאן מה אתה רוצה לעצב..."></textarea>
    <button class="btn btn-primary w-100" onclick="generateAIDesign()">
        <i class="fas fa-robot me-1"></i> צור עיצוב AI
    </button>
</div>

<div class="container my-5" data-save-url="{% url 'main:save_design' %}">
    <div class="row">
        <div class="col-12">
            <h1 class="display-4 text-center mb-4">
                <i class="fas fa-palette me-3"></i>
                עיצוב בהתאמה אישית
            </h1>
            <p class="lead text-center mb-5">
                צרו עיצוב אישי עבור המוצרים שלכם באמצעות עורך הגרפיקה הפשוט שלנו
            </p>
            
            <!-- AI Design Generator Test -->
            <div class="row justify-content-center mb-4">
                <div class="col-md-8">
                    <div class="alert alert-success text-center" style="border: 5px solid #28a745; background: #d4edda; font-size: 18px; font-weight: bold;">
                        <h4 style="color: #155724; margin-bottom: 15px;">
                            <i class="fas fa-magic me-2"></i>🤖 עיצוב באמצעות AI - אזור זה אמור להיות נראה!
                        </h4>
                        <div class="card" style="border: 3px solid #667eea; background: #f8f9fa;">
                            <div class="card-body">
                                <h5 class="card-title text-center" style="color: #667eea;">
                                    <i class="fas fa-magic me-2"></i>🤖 עיצוב באמצעות AI
                                </h5>
                                <textarea id="aiDesignPromptTop" class="form-control mb-3" rows="3" 
                                          placeholder="תאר את העיצוב שאתה רוצה... (לדוגמה: לוגו של כלב חמוד עם כתובת 'Best Friend')"
                                          style="border: 3px solid #ff0000; border-radius: 8px; font-size: 16px; padding: 10px; background: #fff3cd;"></textarea>
                                <button class="btn btn-primary w-100" onclick="generateAIDesign()" 
                                        style="background: linear-gradient(45deg, #667eea, #764ba2); border: none; padding: 15px; font-size: 18px;">
                                    <i class="fas fa-robot me-1"></i> צור עיצוב
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Toolbar -->
        <div class="col-md-3">
            <div class="toolbar">
                <h5 class="mb-3">כלי עיצוב</h5>
                <div class="alert alert-info alert-sm mb-3" style="font-size: 0.8rem; padding: 8px;">
                    <i class="fas fa-info-circle me-1"></i>
                    לחץ על טקסט לעריכה, על רקע האלמנט לגרירה
                </div>
                
                <!-- AI Design Generator - SUPER VISIBLE -->
                <div class="mb-4" style="
                    background: #FF0000 !important; 
                    padding: 30px !important; 
                    border-radius: 15px !important; 
                    border: 10px solid #00FF00 !important;
                    box-shadow: 0 0 50px rgba(255, 0, 0, 0.8) !important;
                    margin: 30px 0 !important;
                    position: relative !important;
                    z-index: 9999 !important;
                    display: block !important;
                    visibility: visible !important;
                    opacity: 1 !important;
                    height: auto !important;
                    width: 100% !important;
                    min-height: 200px !important;
                ">
                    <div class="ai-design-section" style="
                        background: #FFFF00 !important;
                        padding: 20px !important;
                        border: 5px solid #FF00FF !important;
                        border-radius: 10px !important;
                        display: block !important;
                        visibility: visible !important;
                        opacity: 1 !important;
                    ">
                        <h1 style="
                            color: #000000 !important; 
                            font-weight: bold !important; 
                            margin-bottom: 20px !important; 
                            font-size: 30px !important;
                            text-align: center !important;
                            display: block !important;
                            visibility: visible !important;
                            opacity: 1 !important;
                        ">
                            <i class="fas fa-magic me-2"></i>🤖 עיצוב באמצעות AI - אני צריך להיות נראה!!!
                        </h1>
                        <textarea id="aiDesignPrompt" class="form-control mb-3" rows="5" 
                                  placeholder="תאר את העיצוב שאתה רוצה... (לדוגמה: לוגו של כלב חמוד עם כתובת 'Best Friend')"
                                  style="
                                    border: 10px solid #FF0000 !important; 
                                    border-radius: 15px !important; 
                                    font-size: 20px !important;
                                    padding: 20px !important;
                                    background: #FFFFFF !important;
                                    color: #000000 !important;
                                    display: block !important;
                                    visibility: visible !important;
                                    opacity: 1 !important;
                                    width: 100% !important;
                                    height: 100px !important;
                                    min-height: 100px !important;
                                    box-sizing: border-box !important;
                                "></textarea>
                        <button class="btn btn-gradient btn-sm w-100" onclick="generateAIDesign()" id="generateBtn"
                                style="
                                    background: #00FF00 !important; 
                                    color: #000000 !important; 
                                    border: 5px solid #FF0000 !important; 
                                    padding: 20px !important;
                                    font-size: 24px !important;
                                    font-weight: bold !important;
                                    display: block !important;
                                    visibility: visible !important;
                                    opacity: 1 !important;
                                    width: 100% !important;
                                    height: auto !important;
                                    min-height: 60px !important;
                                    box-sizing: border-box !important;
                                ">
                            <i class="fas fa-robot me-1"></i> צור עיצוב עכשיו!
                        </button>
                        <div id="aiStatus" class="mt-2 text-center" style="display: none; color: #667eea;">
                            <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                            <span>יוצר עיצוב...</span>
                        </div>
                    </div>
                </div>
                
                <!-- Product Selection -->
                <div class="product-selection mb-3">
                    <h6>בחר מוצר לעיצוב</h6>
                    <div class="product-grid" id="productGrid">
                        {% for product in products %}
                        <div class="product-option{% if selected_product and selected_product.id == product.id %} selected{% endif %}" data-product-id="{{ product.id }}" data-product-image="{% if product.image %}{{ product.image.url }}{% endif %}" onclick="selectProduct(this)">
                            {% if product.image %}
                                <img src="{{ product.image.url }}" alt="{{ product.name }}">
                            {% else %}
                                <div style="width: 80px; height: 80px; background-color: #f0f0f0; border-radius: 4px; display: flex; align-items: center; justify-content: center; margin-bottom: 5px;">
                                    <i class="fas fa-image" style="color: #ccc; font-size: 24px;"></i>
                                </div>
                            {% endif %}
                            <div class="product-name">{{ product.name }}</div>
                            <div class="product-price">₪{{ product.price }}</div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- Add Text -->
                <div class="mb-3">
                    <button class="btn btn-primary btn-sm w-100" onclick="addText()">
                        <i class="fas fa-font me-1"></i> הוסף טקסט
                    </button>
                </div>
                
                <!-- Add Image -->
                <div class="mb-3">
                    <button class="btn btn-success btn-sm w-100" onclick="document.getElementById('imageInput').click()">
                        <i class="fas fa-image me-1"></i> הוסף תמונה
                    </button>
                    <input type="file" id="imageInput" accept="image/*" style="display: none" onchange="addImage(event)">
                </div>
                
                <!-- Add Emoji -->
                <div class="mb-3">
                    <button class="btn btn-warning btn-sm w-100" onclick="toggleEmojiPicker()">
                        <i class="fas fa-smile me-1"></i> הוסף סמל
                    </button>
                    <div id="emojiPicker" class="emoji-picker" style="display: none;">
                        <span class="emoji-item" onclick="addEmoji('😊')">😊</span>
                        <span class="emoji-item" onclick="addEmoji('❤️')">❤️</span>
                        <span class="emoji-item" onclick="addEmoji('👍')">👍</span>
                        <span class="emoji-item" onclick="addEmoji('🎉')">🎉</span>
                        <span class="emoji-item" onclick="addEmoji('🌟')">🌟</span>
                        <span class="emoji-item" onclick="addEmoji('🔥')">🔥</span>
                        <span class="emoji-item" onclick="addEmoji('💯')">💯</span>
                        <span class="emoji-item" onclick="addEmoji('🚀')">🚀</span>
                        <span class="emoji-item" onclick="addEmoji('🎯')">🎯</span>
                        <span class="emoji-item" onclick="addEmoji('💪')">💪</span>
                        <span class="emoji-item" onclick="addEmoji('🏆')">🏆</span>
                        <span class="emoji-item" onclick="addEmoji('🎨')">🎨</span>
                    </div>
                </div>
                
                <!-- Colors -->
                <div class="mb-3">
                    <h6>צבעים</h6>
                    <div class="current-color-indicator">
                        <div class="current-color-swatch" id="currentColorSwatch"></div>
                        <span id="currentColorText">שחור</span>
                    </div>
                    <div class="d-flex flex-wrap">
                        <input type="color" class="color-picker selected" value="#000000" onchange="changeColor(this.value)" onclick="selectColorPicker(this)" title="שחור">
                        <input type="color" class="color-picker" value="#ff0000" onchange="changeColor(this.value)" onclick="selectColorPicker(this)" title="אדום">
                        <input type="color" class="color-picker" value="#00ff00" onchange="changeColor(this.value)" onclick="selectColorPicker(this)" title="ירוק">
                        <input type="color" class="color-picker" value="#0000ff" onchange="changeColor(this.value)" onclick="selectColorPicker(this)" title="כחול">
                        <input type="color" class="color-picker" value="#ffff00" onchange="changeColor(this.value)" onclick="selectColorPicker(this)" title="צהוב">
                        <input type="color" class="color-picker" value="#ff00ff" onchange="changeColor(this.value)" onclick="selectColorPicker(this)" title="סגול">
                        <input type="color" class="color-picker" value="#00ffff" onchange="changeColor(this.value)" onclick="selectColorPicker(this)" title="תכלת">
                        <input type="color" class="color-picker" value="#ffffff" onchange="changeColor(this.value)" onclick="selectColorPicker(this)" title="לבן">
                    </div>
                </div>
                
                <!-- Font Size -->
                <div class="mb-3">
                    <h6>גודל גופן</h6>
                    <div class="size-control">
                        <input type="range" id="fontSizeSlider" min="12" max="72" value="24" oninput="changeFontSize(this.value)">
                        <span id="fontSizeValue">24px</span>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="mb-3">
                    <button class="btn btn-danger btn-sm w-100 mb-2" onclick="clearCanvas()">
                        <i class="fas fa-trash me-1"></i> נקה הכל
                    </button>
                    <button class="btn btn-info btn-sm w-100" onclick="saveDesign()">
                        <i class="fas fa-save me-1"></i> שמור עיצוב
                    </button>
                </div>
            </div>
        </div>

        <!-- Design Canvas -->
        <div class="col-md-9">
            <div class="product-preview mb-3">
                <div class="design-canvas" id="designCanvas">
                    <div class="canvas-overlay" id="canvasOverlay"></div>
                    <div class="text-center text-muted" id="placeholderText" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10;">
                        <i class="fas fa-tshirt" style="font-size: 100px; opacity: 0.3;"></i>
                        <p>בחר מוצר והתחל לעצב</p>
                    </div>
                </div>
            </div>
            
            <div class="text-center">
                <h5>תצוגה מקדימה של העיצוב</h5>
                <p class="text-muted">
                    בחר מוצר מהרשימה למעלה, ואז גרור ושחרר אלמנטים לתוך אזור העיצוב<br>
                    <small>💡 לחץ על טקסט כדי לערוך, לחץ על רקע כדי לגרור</small>
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Save Modal -->
<div class="modal fade" id="saveModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">שמירת עיצוב</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="designName" class="form-label">שם העיצוב</label>
                    <input type="text" class="form-control" id="designName" placeholder="הכנס שם לעיצוב">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ביטול</button>
                <button type="button" class="btn btn-primary" onclick="confirmSave()">שמור</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'main/js/custom_design.js' %}"></script>
{% endblock %}
