{% extends 'main/base.html' %}
{% load static %}

{% block title %}注爪 砖 - 专 拽住 转{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'main/css/custom_design.css' %}">
{% endblock %}

{% block content %}

<div class="container my-5" data-save-url="{% url 'main:save_design' %}">
    <div class="row">
        <div class="col-12">
            <h1 class="display-4 text-center mb-4">
                <i class="fas fa-palette me-3"></i>
                注爪 转 砖转
            </h1>
            <p class="lead text-center mb-5">
                爪专 注爪 砖 注专 爪专 砖 爪注转 注专 专驻拽 驻砖 砖
            </p>
        </div>
    </div>

    <div class="row">
        <!-- Toolbar -->
        <div class="col-md-3">
            <div class="toolbar">
                <h5 class="mb-3"> 注爪</h5>
                <div class="alert alert-info alert-sm mb-3" style="font-size: 0.8rem; padding: 8px;">
                    <i class="fas fa-info-circle me-1"></i>
                    抓 注 拽住 注专, 注 专拽注  专专
                </div>
                
                <!-- AI Design Generator -->
                <div class="mb-4">
                    <h6 class="mb-3">
                        <i class="fas fa-magic me-2"></i> 注爪 爪注转 AI
                    </h6>
                    <textarea id="aiDesignPrompt" class="form-control mb-3" rows="5" 
                              placeholder="转专 转 注爪 砖转 专爪... (:  砖   注 转转 'Best Friend')"
                              style="
                                border: 10px solid #FF0000 !important; 
                                border-radius: 15px !important; 
                                font-size: 20px !important;
                                padding: 20px !important;
                                background: #FFFFFF !important;
                                color: #000000 !important;
                                display: block !important;
                                visibility: visible !important;
                                opacity: 1 !important;
                                width: 100% !important;
                                height: 100px !important;
                                min-height: 100px !important;
                                box-sizing: border-box !important;
                            "></textarea>
                    <button class="btn btn-gradient btn-sm w-100" onclick="generateAIDesign()" id="generateBtn"
                            style="
                                background: #00FF00 !important; 
                                color: #000000 !important; 
                                border: 5px solid #FF0000 !important; 
                                padding: 20px !important;
                                font-size: 24px !important;
                                font-weight: bold !important;
                                display: block !important;
                                visibility: visible !important;
                                opacity: 1 !important;
                                width: 100% !important;
                                height: auto !important;
                                min-height: 60px !important;
                                box-sizing: border-box !important;
                            ">
                        <i class="fas fa-robot me-1"></i> 爪专 注爪 注砖!
                    </button>
                    <div id="aiStatus" class="mt-2 text-center" style="display: none; color: #667eea;">
                        <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                        <span>爪专 注爪...</span>
                    </div>
                </div>
                
                <!-- Product Selection -->
                <div class="product-selection mb-3">
                    <h6>专 爪专 注爪</h6>
                    <div class="product-grid" id="productGrid">
                        {% for product in products %}
                        <div class="product-option{% if selected_product and selected_product.id == product.id %} selected{% endif %}" data-product-id="{{ product.id }}" data-product-image="{% if product.image %}{{ product.image.url }}{% endif %}" onclick="selectProduct(this)">
                            {% if product.image %}
                                <img src="{{ product.image.url }}" alt="{{ product.name }}">
                            {% else %}
                                <div style="width: 80px; height: 80px; background-color: #f0f0f0; border-radius: 4px; display: flex; align-items: center; justify-content: center; margin-bottom: 5px;">
                                    <i class="fas fa-image" style="color: #ccc; font-size: 24px;"></i>
                                </div>
                            {% endif %}
                            <div class="product-name">{{ product.name }}</div>
                            <div class="product-price">{{ product.price }}</div>
                            {% if product.can_print and product.max_print_width and product.max_print_height %}
                            <div class="product-print-size" style="font-size: 0.75em; color: #666; margin-top: 2px;">
                                <i class="fas fa-expand-arrows-alt me-1"></i>
                                {{ product.max_print_width }}x{{ product.max_print_height }} 住"
                            </div>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- Add Text -->
                <div class="mb-3">
                    <button class="btn btn-primary btn-sm w-100" onclick="addText()">
                        <i class="fas fa-font me-1"></i> 住祝 拽住
                    </button>
                </div>
                
                <!-- Add Image -->
                <div class="mb-3">
                    <button class="btn btn-success btn-sm w-100" onclick="document.getElementById('imageInput').click()">
                        <i class="fas fa-image me-1"></i> 住祝 转
                    </button>
                    <input type="file" id="imageInput" accept="image/*" style="display: none" onchange="addImage(event)">
                </div>
                
                <!-- Add Emoji -->
                <div class="mb-3">
                    <button class="btn btn-warning btn-sm w-100" onclick="toggleEmojiPicker()">
                        <i class="fas fa-smile me-1"></i> 住祝 住
                    </button>
                    <div id="emojiPicker" class="emoji-picker" style="display: none;">
                        <span class="emoji-item" onclick="addEmoji('')"></span>
                        <span class="emoji-item" onclick="addEmoji('わ')">わ</span>
                        <span class="emoji-item" onclick="addEmoji('')"></span>
                        <span class="emoji-item" onclick="addEmoji('')"></span>
                        <span class="emoji-item" onclick="addEmoji('')"></span>
                        <span class="emoji-item" onclick="addEmoji('')"></span>
                        <span class="emoji-item" onclick="addEmoji('')"></span>
                        <span class="emoji-item" onclick="addEmoji('')"></span>
                        <span class="emoji-item" onclick="addEmoji('')"></span>
                        <span class="emoji-item" onclick="addEmoji('')"></span>
                        <span class="emoji-item" onclick="addEmoji('')"></span>
                        <span class="emoji-item" onclick="addEmoji('')"></span>
                    </div>
                </div>
                
                <!-- Colors -->
                <div class="mb-3">
                    <h6>爪注</h6>
                    <div class="current-color-indicator">
                        <div class="current-color-swatch" id="currentColorSwatch"></div>
                        <span id="currentColorText">砖专</span>
                    </div>
                    <div class="d-flex flex-wrap">
                        <input type="color" class="color-picker selected" value="#000000" onchange="changeColor(this.value)" onclick="selectColorPicker(this)" title="砖专">
                        <input type="color" class="color-picker" value="#ff0000" onchange="changeColor(this.value)" onclick="selectColorPicker(this)" title="">
                        <input type="color" class="color-picker" value="#00ff00" onchange="changeColor(this.value)" onclick="selectColorPicker(this)" title="专拽">
                        <input type="color" class="color-picker" value="#0000ff" onchange="changeColor(this.value)" onclick="selectColorPicker(this)" title="">
                        <input type="color" class="color-picker" value="#ffff00" onchange="changeColor(this.value)" onclick="selectColorPicker(this)" title="爪">
                        <input type="color" class="color-picker" value="#ff00ff" onchange="changeColor(this.value)" onclick="selectColorPicker(this)" title="住">
                        <input type="color" class="color-picker" value="#00ffff" onchange="changeColor(this.value)" onclick="selectColorPicker(this)" title="转转">
                        <input type="color" class="color-picker" value="#ffffff" onchange="changeColor(this.value)" onclick="selectColorPicker(this)" title="">
                    </div>
                </div>
                
                <!-- Font Size -->
                <div class="mb-3">
                    <h6> 驻</h6>
                    <div class="size-control">
                        <input type="range" id="fontSizeSlider" min="12" max="72" value="24" oninput="changeFontSize(this.value)">
                        <span id="fontSizeValue">24px</span>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="mb-3">
                    <button class="btn btn-danger btn-sm w-100 mb-2" onclick="clearCanvas()">
                        <i class="fas fa-trash me-1"></i> 拽 
                    </button>
                    <button class="btn btn-info btn-sm w-100" onclick="saveDesign()">
                        <i class="fas fa-save me-1"></i> 砖专 注爪
                    </button>
                </div>
            </div>
        </div>

        <!-- Design Canvas -->
        <div class="col-md-9">
            <div class="product-preview mb-3">
                <div class="design-canvas" id="designCanvas">
                    <div class="canvas-overlay" id="canvasOverlay"></div>
                    <div class="text-center text-muted" id="placeholderText" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10;">
                        <i class="fas fa-tshirt" style="font-size: 100px; opacity: 0.3;"></i>
                        <p>专 爪专 转 注爪</p>
                    </div>
                </div>
            </div>
            
            <div class="text-center">
                <h5>转爪 拽 砖 注爪</h5>
                <p class="text-muted">
                    专 爪专 专砖 注,  专专 砖专专  转 专 注爪<br>
                    <small> 抓 注 拽住  注专, 抓 注 专拽注  专专</small>
                </p>
                <div id="printDimensions" class="alert alert-info" style="display: none;">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>转 驻住 拽住转:</strong> <span id="printDimensionsText"></span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Save Modal -->
<div class="modal fade" id="saveModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">砖专转 注爪</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="designName" class="form-label">砖 注爪</label>
                    <input type="text" class="form-control" id="designName" placeholder="住 砖 注爪">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"></button>
                <button type="button" class="btn btn-primary" onclick="confirmSave()">砖专</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'main/js/custom_design.js' %}?v={{ current_time }}"></script>
{% endblock %}
